# Cryptolalia Tree 密语树

使用区块链的技术，对信息进行非对称加密，以及不可篡改的保护。

## 特性

1. 每一个端到端的对话、或者是群组聊天，它们的本质都一样，就是 N 条密语链，密语链是天然分叉的。
   1. 链需要同步，并且也会合并区块，但并不要求其它节点的区块链与自己的链完全一致
   1. 每条链只会以自己收到的信息为准
1. 密语链需要有一个创造者，它将定义这条链的元数据
   1. 每一个参与到此链的地址，都需要配置一个独一无二的“链密钥”，用来定义接下来的自己发送的信息应该使用什么进行加密解密
   1. “链密钥”是一个随机种子，使用它与信息元数据一起配合计算出本信息加密时所使用的“信密钥”
   1. 信息元数据是非加密的公开的信息，比如时间或者噪点等独立无意义的信息
   1. 也就是说“链密钥”能根据信息元数据推理出“信密钥”，反之不能
   1. 在将一个群组的消息进行转发的时候，本质上就是将单条信息的“信密钥”转发到另一个群组，不会有其它信息被泄漏
1. 密语链链的同步不是必须从第一个区块开始，因为它不需要记账，也就不需要计算账户信息，所以从任何一个高度开始同步都是可行的（但这并不意味着会被篡改）
1. 因为不用算帐，也就没有传统意义上的分叉，所以密语链能够合并游离的消息。游离消息分为两种：
   1. 离线消息：是指个人的消息与群组游离
   1. 小组讨论：是指多人的消息与群组游离
1. 密语链的分叉，会从人员的加入与离开进行触发。分叉后本质上是重新开始一条新的链，也就是说“链密钥”会被重新定义

## 实现原理

1. 消息的本质就是区块，每一条消息就是一个区块，它会基于上一条消息来进行串联。但这样的串联只是一个信息上的意义，不会有其它影响
1. 如果多方同时对一个区块 X 进行串联，也就是从区块 X 开始分叉
1. 消息有几种基本的类型：
   1. 上线状态
   1. 下线状态
   1. 合并消息
      携带：
   1. 文本消息
      携带：文本内容
   1. 图片消息
      携带：图片数据
   1. 确认已读
      携带：指定消息编号
   1. 加入密语
      携带：邀请者
   1. 离开密语
      携带：送别者
   1. 新的链密钥
      携带：根据目前在链人员的的公钥非对称加密后的新链密钥
1. 因为去中心化的区块链技术，所以一旦网络离线，那么自己就会进入传统意义上独自打块的情况

## 时间

<!-- 1. 消息有发送时间与接收时间，二者的差值就是相对时间。
1. 本地时间会根据这个相对时间统一做调整
1. 发送的信息的发送时间 = 当前时间 - 本地收到创世块时候的时间
1. 收到消息的显示时间 = 发送的信息的发送时间 + 本地收到创世块时候的时间 -->

1. 信息显示一律以本地接收时间为准，对方的发送时间只会用于参考信息进行显示
   1. 如果收到一条消息的发送时间与自己最新消息的时间是倒序的，会显示成“迟到的消息”
1. 

## 轮流打块

1. 每一条链都是完全独立的存在，消息的时间没有直接意义，在区块中只是数据包一般的存在
1. 本地的链不会被其它任何人给篡改，每个人自会打自己的区块
   1. 区块使用相对时间为时间间隔进行锻造，每 2 分钟有一个区块，如果有数据的话。
1. 向其它链同步，同步下来的区块我们需要的只是区块里头的数据包，把数据包拿出来自己锻造区块
1. 本地会按照相对时间顺序存储消息，并为这些消息的时间构建链上链、链上链上链的 hash 签名，方便大规模同步的时候，快速定位有差异的时间段
